import{a as qe,r as u,m as Le,N as Oe,G as be,S as b,J as Y,c as a,e as s,l as Z,g as c,F as h,h as V,t as d,n as w,O as y,Q as f,P as Be,s as D,f as L,w as O,T as B,L as T,M as ee,o,_ as je}from"./index-I9RjNgOI.js";const ze={class:"chatroom-view"},Ee={class:"user-panel m3-card"},Re={class:"panel-header"},Je={class:"user-list"},Fe=["onClick"],Ke={class:"user-avatar"},Qe=["src","alt"],He={key:1,class:"material-symbols-rounded"},Ae={class:"user-info"},Ge={class:"user-name"},We={class:"user-id"},Xe=["onClick"],Ye={key:0,class:"empty-state"},Ze={class:"chat-panel m3-card"},es={class:"chat-header"},ss={key:0,class:"header-content"},ts={class:"user-avatar"},ls=["src","alt"],os={key:1,class:"material-symbols-rounded"},as={class:"user-info"},ns={key:0},is={key:1,class:"header-placeholder"},rs={class:"header-actions"},us={key:0,class:"welcome-state"},ds={key:1,class:"loading-state"},cs={key:2,class:"messages-list"},ms={class:"banner-content"},vs={class:"banner-text"},ps={class:"message-avatar"},ys={class:"material-symbols-rounded"},fs={class:"message-content"},_s={class:"message-header"},gs={class:"message-sender"},bs={class:"message-time"},ks={key:0,class:"message-quote"},hs={class:"quote-content"},ws={class:"quote-author"},Cs={class:"quote-text"},xs={key:1,class:"message-text"},Us={key:2,class:"message-emojis"},$s=["src"],Vs={class:"message-actions"},Ds=["onClick"],Ts={key:0,class:"empty-messages"},Ms={key:0,class:"reply-bar"},Is={class:"reply-bar-left"},Ns={class:"reply-bar-content"},Ss={class:"reply-bar-name"},Ps={class:"reply-bar-text"},qs={class:"input-area"},Ls={class:"input-container"},Os=["disabled","onKeydown"],Bs=["disabled"],js={class:"material-symbols-rounded"},zs={class:"m3-dialog"},Es={class:"dialog-header"},Rs={class:"dialog-content"},Js={class:"copy-user-section"},Fs={class:"input-row"},Ks={class:"input-group half"},Qs={key:0,class:"custom-select-dropdown"},Hs={key:0,class:"material-symbols-rounded check-icon"},As=["onClick"],Gs={key:0,class:"material-symbols-rounded check-icon"},Ws={class:"input-group half"},Xs={key:0,class:"custom-select-dropdown"},Ys={key:0,class:"material-symbols-rounded check-icon"},Zs=["onClick"],et={key:0,class:"material-symbols-rounded check-icon"},st={class:"input-group"},tt={class:"input-with-action"},lt={class:"input-group"},ot={class:"input-group"},at={class:"input-group"},nt={class:"input-group"},it={class:"label-row"},rt={class:"memory-points-list"},ut={class:"point-header"},dt={class:"point-label"},ct=["onClick"],mt={class:"point-content"},vt=["onUpdate:modelValue"],pt={class:"point-weight"},yt=["onUpdate:modelValue"],ft={key:0,class:"empty-points"},_t={class:"input-group"},gt={class:"input-group"},bt={class:"dialog-actions"},kt=["disabled"],ht={class:"m3-dialog"},wt={class:"dialog-header"},Ct={class:"dialog-content"},xt={class:"input-group"},Ut={class:"input-group"},$t={class:"input-group"},Vt={class:"input-group"},Dt={class:"label-row"},Tt={class:"memory-points-list"},Mt={class:"point-header"},It={class:"point-label"},Nt=["onClick"],St={class:"point-content"},Pt=["onUpdate:modelValue"],qt={class:"point-weight"},Lt=["onUpdate:modelValue"],Ot={key:0,class:"empty-points"},Bt={class:"input-group"},jt={class:"input-group"},zt={class:"dialog-actions"},Et=["disabled"],Rt={class:"m3-dialog small"},Jt={class:"dialog-header"},Ft={class:"dialog-content"},Kt={class:"dialog-actions"},Qt=["disabled"],Ht={class:"m3-dialog small"},At={class:"dialog-header"},Gt={class:"dialog-content"},Wt={class:"dialog-actions"},Xt=["disabled"],Yt=1e3,Zt=qe({__name:"ChatroomView",setup(el){const E=u([]),n=u(null),C=u([]),M=u(""),se=u(!1),I=u(!1),te=u(!1);let j=null;const R=u(new Map),g=u(null),x=u(!1),N=u(!1),S=u(!1),P=u(!1),q=u(null),J=u([]),F=u([]),ie=u([]),k=u(""),_=u(null),U=u(!1),$=u(!1),i=u({user_id:"",nickname:"",impression:"",short_impression:"",avatar:"",attitude:null,memory_points:[]}),v=u({nickname:"",impression:"",short_impression:"",avatar:"",attitude:null,memory_points:[]}),K=u(!1),Q=u(!1),H=u(!1),A=u(!1),G=u(null),W=u(null);Le(async()=>{await z(),pe(),window.addEventListener("click",ce)}),Oe(()=>{X(),window.removeEventListener("click",ce)}),be(n,async(l,e)=>{l?(await le(),(e==null?void 0:e.user_id)!==l.user_id&&(g.value=null,X(),pe())):(C.value=[],g.value=null,X())}),be(x,l=>{l&&($e(),me(),k.value="",_.value=null)});async function z(){try{const l=await b.get("chatroom/users");l.success&&l.data?E.value=l.data.users||[]:m("加载用户列表失败: "+(l.error||"未知错误"),"error")}catch(l){console.error("加载用户列表失败:",l),m("加载用户列表失败","error")}}async function le(){if(n.value){se.value=!0;try{const l=await b.get("chatroom/messages?limit=100");if(l.success&&l.data){C.value=l.data.messages||[];for(const e of C.value)e.reply_to&&await fe(e.reply_to);await Y(),oe()}else m("加载消息失败: "+(l.error||"未知错误"),"error")}catch(l){console.error("加载消息失败:",l),m("加载消息失败","error")}finally{se.value=!1}}}function ke(l){n.value=l,v.value={nickname:l.nickname,impression:l.impression,short_impression:l.short_impression||"",avatar:l.avatar,attitude:l.attitude??null,memory_points:l.memory_points?JSON.parse(JSON.stringify(l.memory_points)):[]}}async function he(){if(!i.value.user_id||!i.value.nickname){m("请填写必填字段","error");return}if(!/^\d+$/.test(i.value.user_id)){m("用户ID只能包含数字","error");return}i.value.memory_points=i.value.memory_points.filter(l=>l.content.trim()),K.value=!0;try{const l=await b.post("chatroom/users",i.value);l.success?(m("创建用户成功","success"),x.value=!1,i.value={user_id:"",nickname:"",impression:"",short_impression:"",avatar:"",attitude:null,memory_points:[]},await z()):m(l.error||"创建用户失败","error")}catch(l){console.error("创建用户失败:",l),m(l.message||"创建用户失败","error")}finally{K.value=!1}}async function we(){var l;if(n.value){v.value.memory_points=v.value.memory_points.filter(e=>e.content.trim()),Q.value=!0;try{const e=await b.put(`chatroom/users/${n.value.user_id}`,v.value);e.success?(m("更新用户成功","success"),N.value=!1,await z(),(l=e.data)!=null&&l.user&&(n.value=e.data.user)):m(e.error||"更新用户失败","error")}catch(e){console.error("更新用户失败:",e),m(e.message||"更新用户失败","error")}finally{Q.value=!1}}}function Ce(l){q.value=l,S.value=!0}async function xe(){var l;if(q.value){H.value=!0;try{const e=await b.delete(`chatroom/users/${q.value.user_id}`);e.success?(m("删除用户成功","success"),S.value=!1,((l=n.value)==null?void 0:l.user_id)===q.value.user_id&&(n.value=null),q.value=null,await z()):m(e.error||"删除用户失败","error")}catch(e){console.error("删除用户失败:",e),m(e.message||"删除用户失败","error")}finally{H.value=!1}}}async function Ue(){if(n.value){A.value=!0;try{const l=await b.post(`chatroom/users/${n.value.user_id}/reset`);if(l.success){m("用户关系已重置","success"),P.value=!1,await le(),await z();const e=E.value.find(t=>{var r;return t.user_id===((r=n.value)==null?void 0:r.user_id)});e&&(n.value=e)}else m(l.error||"重置失败","error")}catch(l){console.error("重置用户失败:",l),m(l.message||"重置失败","error")}finally{A.value=!1}}}async function $e(){try{const l=await b.get("chatroom/copyable_users");if(l.success&&l.data){J.value=l.data.users||[];const e=new Set(J.value.map(t=>t.platform));ie.value=Array.from(e).sort(),re()}}catch(l){console.error("加载可复制用户失败:",l)}}function re(){k.value?F.value=J.value.filter(l=>l.platform===k.value):F.value=J.value,_.value&&!F.value.find(l=>{var e;return l.person_id===((e=_.value)==null?void 0:e.person_id)})&&(_.value=null)}function Ve(l){l.stopPropagation(),U.value=!U.value,$.value=!1}function ue(l){k.value=l,re(),U.value=!1}function De(l){l.stopPropagation(),$.value=!$.value,U.value=!1}function de(l){_.value=l,Te(),$.value=!1}function ce(l){l.target.closest(".custom-select-container")||(U.value=!1,$.value=!1)}function Te(){if(_.value){const l=_.value;i.value.nickname=l.nickname,i.value.impression=l.impression||"",i.value.short_impression=l.short_impression||"",i.value.attitude=l.attitude,i.value.memory_points=l.memory_points?JSON.parse(JSON.stringify(l.memory_points)):[]}}function me(){const l=Math.floor(Math.random()*9e5+1e5).toString();i.value.user_id=l}async function ve(){if(!(!M.value.trim()||!n.value||I.value)){I.value=!0;try{const l={user_id:n.value.user_id,content:M.value.trim(),message_type:"text"};g.value&&(l.reply_to=g.value.message_id);const e=await b.post("chatroom/send",l);if(e.success&&e.data){if(e.data.request_message){const t=e.data.request_message;t.reply_to&&g.value&&R.value.set(t.reply_to,g.value),C.value.push(t)}M.value="",g.value=null,W.value&&(W.value.style.height="auto"),await Y(),oe()}else m(e.error||"发送消息失败","error")}catch(l){console.error("发送消息失败:",l),m(l.message||"发送消息失败","error")}finally{I.value=!1}}}function Me(l){const e=l.target;e.style.height="auto",e.style.height=Math.min(e.scrollHeight,120)+"px"}function oe(){G.value&&(G.value.scrollTop=G.value.scrollHeight)}function pe(){!j&&n.value&&(ye(),j=window.setInterval(ye,Yt))}function X(){j&&(clearInterval(j),j=null)}async function ye(){var l;if(!n.value){X();return}try{const e=await b.get("chatroom/poll");if(e.success&&((l=e.data)!=null&&l.messages)&&e.data.messages.length>0){for(const t of e.data.messages)C.value.find(r=>r.message_id===t.message_id)||(C.value.push(t),t.reply_to&&await fe(t.reply_to));await Y(),oe()}}catch(e){console.error("轮询消息失败:",e)}}async function fe(l){var e;if(!R.value.has(l))try{const t=await b.get(`chatroom/messages/${l}`);t.success&&((e=t.data)!=null&&e.message)&&R.value.set(l,t.data.message)}catch(t){console.error("加载引用消息失败:",t)}}function ae(l){return R.value.get(l)||null}function Ie(l){g.value=l,Y(()=>{var e;return(e=W.value)==null?void 0:e.focus()})}function Ne(){g.value=null}function Se(l){const e=new Date(l*1e3),t=new Date,r=t.getTime()-e.getTime();return r<864e5&&e.getDate()===t.getDate()?e.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):r<1728e5&&e.getDate()===t.getDate()-1?"昨天 "+e.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):e.toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}function _e(l){l.push({content:"",weight:1})}function ge(l,e){l.splice(e,1)}function m(l,e="success"){const t=document.createElement("div");t.className=`toast toast-${e}`,t.textContent=l,t.style.cssText=`
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 12px 20px;
    background: ${e==="success"?"var(--md-sys-color-primary)":"var(--md-sys-color-error)"};
    color: ${e==="success"?"var(--md-sys-color-on-primary)":"var(--md-sys-color-on-error)"};
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    z-index: 10000;
    animation: slideIn 0.3s ease;
  `,document.body.appendChild(t),setTimeout(()=>{t.style.animation="slideOut 0.3s ease",setTimeout(()=>{document.body.removeChild(t)},300)},3e3)}return(l,e)=>(o(),a("div",ze,[s("aside",Ee,[s("div",Re,[e[35]||(e[35]=s("div",{class:"header-content"},[s("span",{class:"material-symbols-rounded"},"people"),s("h2",null,"虚拟用户")],-1)),s("button",{class:"m3-button icon-only",onClick:e[0]||(e[0]=t=>x.value=!0),title:"创建用户"},[...e[34]||(e[34]=[s("span",{class:"material-symbols-rounded"},"person_add",-1)])])]),s("div",Je,[(o(!0),a(h,null,V(E.value,t=>{var r;return o(),a("div",{key:t.user_id,class:w(["user-item",{active:((r=n.value)==null?void 0:r.user_id)===t.user_id}]),onClick:p=>ke(t)},[s("div",Ke,[t.avatar?(o(),a("img",{key:0,src:t.avatar,alt:t.nickname},null,8,Qe)):(o(),a("span",He,"account_circle"))]),s("div",Ae,[s("div",Ge,d(t.nickname),1),s("div",We,d(t.user_id),1)]),s("button",{class:"m3-icon-button delete-btn",onClick:D(p=>Ce(t),["stop"]),title:"删除用户"},[...e[36]||(e[36]=[s("span",{class:"material-symbols-rounded"},"delete",-1)])],8,Xe)],10,Fe)}),128)),E.value.length===0?(o(),a("div",Ye,[e[37]||(e[37]=s("span",{class:"material-symbols-rounded"},"group_off",-1)),e[38]||(e[38]=s("p",null,"暂无虚拟用户",-1)),s("button",{class:"m3-button filled",onClick:e[1]||(e[1]=t=>x.value=!0)}," 创建第一个用户 ")])):c("",!0)])]),s("main",Ze,[s("header",es,[n.value?(o(),a("div",ss,[s("div",ts,[n.value.avatar?(o(),a("img",{key:0,src:n.value.avatar,alt:n.value.nickname},null,8,ls)):(o(),a("span",os,"account_circle"))]),s("div",as,[s("h2",null,d(n.value.nickname),1),n.value.impression?(o(),a("p",ns,d(n.value.impression),1)):c("",!0)])])):(o(),a("div",is,[...e[39]||(e[39]=[s("span",{class:"material-symbols-rounded"},"chat",-1),s("span",null,"UI 聊天室",-1)])])),s("div",rs,[n.value?(o(),a("button",{key:0,class:"m3-button icon-only",onClick:e[2]||(e[2]=t=>P.value=!0),title:"重置关系"},[...e[40]||(e[40]=[s("span",{class:"material-symbols-rounded"},"restart_alt",-1)])])):c("",!0),n.value?(o(),a("button",{key:1,class:"m3-button icon-only",onClick:e[3]||(e[3]=t=>N.value=!0),title:"编辑用户"},[...e[41]||(e[41]=[s("span",{class:"material-symbols-rounded"},"edit",-1)])])):c("",!0),s("button",{class:"m3-button icon-only",onClick:le,title:"刷新消息"},[...e[42]||(e[42]=[s("span",{class:"material-symbols-rounded"},"refresh",-1)])])])]),s("div",{class:"messages-container",ref_key:"messagesContainer",ref:G},[n.value?se.value?(o(),a("div",ds,[...e[44]||(e[44]=[s("div",{class:"spinner"},null,-1),s("p",null,"加载消息中...",-1)])])):(o(),a("div",cs,[(o(!0),a(h,null,V(C.value,t=>{var r,p;return o(),a("div",{key:t.message_id,class:w({message:t.user_id!=="system","system-banner":t.user_id==="system","is-bot":t.user_id==="mofox_bot","is-user":t.user_id!=="mofox_bot"&&t.user_id!=="system"})},[t.user_id==="system"?(o(),a(h,{key:0},[e[45]||(e[45]=s("div",{class:"banner-icon"},[s("span",{class:"material-symbols-rounded"},"info")],-1)),s("div",ms,[s("span",vs,d(t.content),1)])],64)):(o(),a(h,{key:1},[s("div",ps,[s("span",ys,d(t.user_id==="mofox_bot"?"smart_toy":"account_circle"),1)]),s("div",fs,[s("div",_s,[s("span",gs,d(t.nickname),1),s("span",bs,d(Se(t.timestamp)),1)]),t.reply_to&&ae(t.reply_to)?(o(),a("div",ks,[e[46]||(e[46]=s("div",{class:"quote-line"},null,-1)),s("div",hs,[s("span",ws,d((r=ae(t.reply_to))==null?void 0:r.nickname),1),s("span",Cs,d((p=ae(t.reply_to))==null?void 0:p.content),1)])])):c("",!0),t.content?(o(),a("div",xs,d(t.content),1)):c("",!0),t.emojis&&t.emojis.length>0?(o(),a("div",Us,[(o(!0),a(h,null,V(t.emojis,(ne,Pe)=>(o(),a("img",{key:Pe,src:`data:image/png;base64,${ne}`,class:"emoji-image",alt:"emoji"},null,8,$s))),128))])):c("",!0),s("div",Vs,[n.value?(o(),a("button",{key:0,class:"message-reply-btn",onClick:D(ne=>Ie(t),["stop"]),title:"引用回复"},[...e[47]||(e[47]=[s("span",{class:"material-symbols-rounded"},"reply",-1)])],8,Ds)):c("",!0)])])],64))],2)}),128)),C.value.length===0?(o(),a("div",Ts,[...e[48]||(e[48]=[s("span",{class:"material-symbols-rounded"},"chat_bubble_outline",-1),s("p",null,"还没有消息，发送第一条消息开始对话吧！",-1)])])):c("",!0)])):(o(),a("div",us,[...e[43]||(e[43]=[s("span",{class:"material-symbols-rounded"},"forum",-1),s("h3",null,"欢迎使用 UI 聊天室",-1),s("p",null,"选择一个虚拟用户开始对话",-1)])]))],512),g.value?(o(),a("div",Ms,[s("div",Is,[e[49]||(e[49]=s("span",{class:"material-symbols-rounded reply-bar-icon"},"reply",-1)),s("div",Ns,[s("span",Ss,"回复 "+d(g.value.nickname),1),s("span",Ps,d(g.value.content||"[表情/图片]"),1)])]),s("button",{class:"m3-icon-button reply-bar-close",onClick:Ne,title:"取消引用"},[...e[50]||(e[50]=[s("span",{class:"material-symbols-rounded"},"close",-1)])])])):c("",!0),s("footer",qs,[s("div",Ls,[s("div",{class:w(["input-wrapper",{focused:te.value}])},[y(s("textarea",{"onUpdate:modelValue":e[4]||(e[4]=t=>M.value=t),class:"message-input",placeholder:"输入消息...",rows:"1",disabled:!n.value||I.value,onKeydown:Be(D(ve,["exact","prevent"]),["enter"]),onInput:Me,onFocus:e[5]||(e[5]=t=>te.value=!0),onBlur:e[6]||(e[6]=t=>te.value=!1),ref_key:"messageInput",ref:W},null,40,Os),[[f,M.value]])],2),s("button",{class:"m3-button fab",disabled:!M.value.trim()||!n.value||I.value,onClick:ve,title:"发送 (Enter)"},[s("span",js,d(I.value?"hourglass_empty":"send"),1)],8,Bs)])])]),(o(),Z(ee,{to:"body"},[L(B,{name:"dialog"},{default:O(()=>[x.value?(o(),a("div",{key:0,class:"dialog-overlay",onClick:e[18]||(e[18]=D(t=>x.value=!1,["self"]))},[s("div",zs,[s("div",Es,[e[52]||(e[52]=s("h3",null,"创建虚拟用户",-1)),s("button",{class:"m3-icon-button",onClick:e[7]||(e[7]=t=>x.value=!1)},[...e[51]||(e[51]=[s("span",{class:"material-symbols-rounded"},"close",-1)])])]),s("div",Rs,[s("div",Js,[e[59]||(e[59]=s("div",{class:"section-title"},"从现有用户复制",-1)),s("div",Fs,[s("div",Ks,[e[55]||(e[55]=s("label",null,"平台",-1)),s("div",{class:w(["custom-select-container",{"is-open":U.value}])},[s("div",{class:"custom-select-trigger",onClick:Ve},[s("span",null,d(k.value||"全部平台"),1),e[53]||(e[53]=s("span",{class:"material-symbols-rounded select-arrow"},"expand_more",-1))]),L(B,{name:"select-fade"},{default:O(()=>[U.value?(o(),a("div",Qs,[s("div",{class:w(["custom-select-option",{"is-selected":k.value===""}]),onClick:e[8]||(e[8]=t=>ue(""))},[e[54]||(e[54]=T(" 全部平台 ",-1)),k.value===""?(o(),a("span",Hs,"check")):c("",!0)],2),(o(!0),a(h,null,V(ie.value,t=>(o(),a("div",{key:t,class:w(["custom-select-option",{"is-selected":k.value===t}]),onClick:r=>ue(t)},[T(d(t)+" ",1),k.value===t?(o(),a("span",Gs,"check")):c("",!0)],10,As))),128))])):c("",!0)]),_:1})],2)]),s("div",Ws,[e[58]||(e[58]=s("label",null,"选择用户",-1)),s("div",{class:w(["custom-select-container",{"is-open":$.value}])},[s("div",{class:"custom-select-trigger",onClick:De},[s("span",null,d(_.value?`${_.value.nickname} (${_.value.platform})`:"不复制"),1),e[56]||(e[56]=s("span",{class:"material-symbols-rounded select-arrow"},"expand_more",-1))]),L(B,{name:"select-fade"},{default:O(()=>[$.value?(o(),a("div",Xs,[s("div",{class:w(["custom-select-option",{"is-selected":_.value===null}]),onClick:e[9]||(e[9]=t=>de(null))},[e[57]||(e[57]=T(" 不复制 ",-1)),_.value===null?(o(),a("span",Ys,"check")):c("",!0)],2),(o(!0),a(h,null,V(F.value,t=>{var r,p;return o(),a("div",{key:t.person_id,class:w(["custom-select-option",{"is-selected":((r=_.value)==null?void 0:r.person_id)===t.person_id}]),onClick:ne=>de(t)},[T(d(t.nickname)+" ("+d(t.platform)+") ",1),((p=_.value)==null?void 0:p.person_id)===t.person_id?(o(),a("span",et,"check")):c("",!0)],10,Zs)}),128))])):c("",!0)]),_:1})],2)])])]),e[70]||(e[70]=s("div",{class:"divider"},null,-1)),s("div",st,[e[61]||(e[61]=s("label",null,[T("用户ID * "),s("span",{class:"hint"},"(仅限数字)")],-1)),s("div",tt,[y(s("input",{"onUpdate:modelValue":e[10]||(e[10]=t=>i.value.user_id=t),type:"text",class:"m3-input",placeholder:"例如: 10001",pattern:"[0-9]+"},null,512),[[f,i.value.user_id]]),s("button",{class:"m3-icon-button",onClick:me,title:"随机生成"},[...e[60]||(e[60]=[s("span",{class:"material-symbols-rounded"},"refresh",-1)])])])]),s("div",lt,[e[62]||(e[62]=s("label",null,"昵称 *",-1)),y(s("input",{"onUpdate:modelValue":e[11]||(e[11]=t=>i.value.nickname=t),type:"text",class:"m3-input",placeholder:"例如: 小明"},null,512),[[f,i.value.nickname]])]),s("div",ot,[e[63]||(e[63]=s("label",null,"详细印象/性格描述",-1)),y(s("textarea",{"onUpdate:modelValue":e[12]||(e[12]=t=>i.value.impression=t),class:"m3-input",rows:"3",placeholder:"例如: 活泼开朗，喜欢聊天，经常分享生活趣事..."},null,512),[[f,i.value.impression]])]),s("div",at,[e[64]||(e[64]=s("label",null,"简短印象",-1)),y(s("input",{"onUpdate:modelValue":e[13]||(e[13]=t=>i.value.short_impression=t),type:"text",class:"m3-input",placeholder:"例如: 活泼开朗"},null,512),[[f,i.value.short_impression]])]),s("div",nt,[s("div",it,[e[66]||(e[66]=s("label",null,"记忆点",-1)),s("button",{class:"m3-button text small",onClick:e[14]||(e[14]=t=>_e(i.value.memory_points))},[...e[65]||(e[65]=[s("span",{class:"material-symbols-rounded"},"add",-1),T(" 添加 ",-1)])])]),s("div",rt,[(o(!0),a(h,null,V(i.value.memory_points,(t,r)=>(o(),a("div",{key:r,class:"memory-point-item"},[s("div",ut,[s("span",dt,"记忆点 #"+d(r+1),1),s("button",{class:"m3-icon-button small",onClick:p=>ge(i.value.memory_points,r)},[...e[67]||(e[67]=[s("span",{class:"material-symbols-rounded"},"delete",-1)])],8,ct)]),s("div",mt,[y(s("textarea",{"onUpdate:modelValue":p=>t.content=p,class:"m3-input",rows:"2",placeholder:"输入记忆内容..."},null,8,vt),[[f,t.content]])]),s("div",pt,[s("label",null,"重要度: "+d(t.weight),1),y(s("input",{"onUpdate:modelValue":p=>t.weight=p,type:"range",min:"0.1",max:"2.0",step:"0.1",class:"m3-slider"},null,8,yt),[[f,t.weight,void 0,{number:!0}]])])]))),128)),i.value.memory_points.length===0?(o(),a("div",ft," 暂无记忆点 ")):c("",!0)])]),s("div",_t,[e[68]||(e[68]=s("label",null,"态度值 (-100 到 100)",-1)),y(s("input",{"onUpdate:modelValue":e[15]||(e[15]=t=>i.value.attitude=t),type:"number",class:"m3-input",min:"-100",max:"100",placeholder:"0"},null,512),[[f,i.value.attitude,void 0,{number:!0}]])]),s("div",gt,[e[69]||(e[69]=s("label",null,"头像URL (可选)",-1)),y(s("input",{"onUpdate:modelValue":e[16]||(e[16]=t=>i.value.avatar=t),type:"text",class:"m3-input",placeholder:"https://..."},null,512),[[f,i.value.avatar]])])]),s("div",bt,[s("button",{class:"m3-button text",onClick:e[17]||(e[17]=t=>x.value=!1)},"取消"),s("button",{class:"m3-button filled",disabled:!i.value.user_id||!i.value.nickname||K.value,onClick:he},d(K.value?"创建中...":"创建"),9,kt)])])])):c("",!0)]),_:1})])),(o(),Z(ee,{to:"body"},[L(B,{name:"dialog"},{default:O(()=>[N.value?(o(),a("div",{key:0,class:"dialog-overlay",onClick:e[27]||(e[27]=D(t=>N.value=!1,["self"]))},[s("div",ht,[s("div",wt,[e[72]||(e[72]=s("h3",null,"编辑用户",-1)),s("button",{class:"m3-icon-button",onClick:e[19]||(e[19]=t=>N.value=!1)},[...e[71]||(e[71]=[s("span",{class:"material-symbols-rounded"},"close",-1)])])]),s("div",Ct,[s("div",xt,[e[73]||(e[73]=s("label",null,"昵称",-1)),y(s("input",{"onUpdate:modelValue":e[20]||(e[20]=t=>v.value.nickname=t),type:"text",class:"m3-input"},null,512),[[f,v.value.nickname]])]),s("div",Ut,[e[74]||(e[74]=s("label",null,"详细印象/性格描述",-1)),y(s("textarea",{"onUpdate:modelValue":e[21]||(e[21]=t=>v.value.impression=t),class:"m3-input",rows:"3",placeholder:"详细描述用户的印象和性格特点..."},null,512),[[f,v.value.impression]])]),s("div",$t,[e[75]||(e[75]=s("label",null,"简短印象",-1)),y(s("input",{"onUpdate:modelValue":e[22]||(e[22]=t=>v.value.short_impression=t),type:"text",class:"m3-input",placeholder:"用简短词语概括"},null,512),[[f,v.value.short_impression]])]),s("div",Vt,[s("div",Dt,[e[77]||(e[77]=s("label",null,"记忆点",-1)),s("button",{class:"m3-button text small",onClick:e[23]||(e[23]=t=>_e(v.value.memory_points))},[...e[76]||(e[76]=[s("span",{class:"material-symbols-rounded"},"add",-1),T(" 添加 ",-1)])])]),s("div",Tt,[(o(!0),a(h,null,V(v.value.memory_points,(t,r)=>(o(),a("div",{key:r,class:"memory-point-item"},[s("div",Mt,[s("span",It,"记忆点 #"+d(r+1),1),s("button",{class:"m3-icon-button small",onClick:p=>ge(v.value.memory_points,r)},[...e[78]||(e[78]=[s("span",{class:"material-symbols-rounded"},"delete",-1)])],8,Nt)]),s("div",St,[y(s("textarea",{"onUpdate:modelValue":p=>t.content=p,class:"m3-input",rows:"2",placeholder:"输入记忆内容..."},null,8,Pt),[[f,t.content]])]),s("div",qt,[s("label",null,"重要度: "+d(t.weight),1),y(s("input",{"onUpdate:modelValue":p=>t.weight=p,type:"range",min:"0.1",max:"2.0",step:"0.1",class:"m3-slider"},null,8,Lt),[[f,t.weight,void 0,{number:!0}]])])]))),128)),v.value.memory_points.length===0?(o(),a("div",Ot," 暂无记忆点 ")):c("",!0)])]),s("div",Bt,[e[79]||(e[79]=s("label",null,"态度值 (-100 到 100)",-1)),y(s("input",{"onUpdate:modelValue":e[24]||(e[24]=t=>v.value.attitude=t),type:"number",class:"m3-input",min:"-100",max:"100",placeholder:"数值化的态度评分"},null,512),[[f,v.value.attitude,void 0,{number:!0}]])]),s("div",jt,[e[80]||(e[80]=s("label",null,"头像URL",-1)),y(s("input",{"onUpdate:modelValue":e[25]||(e[25]=t=>v.value.avatar=t),type:"text",class:"m3-input",placeholder:"https://..."},null,512),[[f,v.value.avatar]])])]),s("div",zt,[s("button",{class:"m3-button text",onClick:e[26]||(e[26]=t=>N.value=!1)},"取消"),s("button",{class:"m3-button filled",disabled:Q.value,onClick:we},d(Q.value?"保存中...":"保存"),9,Et)])])])):c("",!0)]),_:1})])),(o(),Z(ee,{to:"body"},[L(B,{name:"dialog"},{default:O(()=>{var t;return[S.value?(o(),a("div",{key:0,class:"dialog-overlay",onClick:e[30]||(e[30]=D(r=>S.value=!1,["self"]))},[s("div",Rt,[s("div",Jt,[e[82]||(e[82]=s("h3",null,"确认删除",-1)),s("button",{class:"m3-icon-button",onClick:e[28]||(e[28]=r=>S.value=!1)},[...e[81]||(e[81]=[s("span",{class:"material-symbols-rounded"},"close",-1)])])]),s("div",Ft,[s("p",null,'确定要删除用户 "'+d((t=q.value)==null?void 0:t.nickname)+'" 吗？',1),e[83]||(e[83]=s("p",{class:"warning-text"},"此操作不可撤销",-1))]),s("div",Kt,[s("button",{class:"m3-button text",onClick:e[29]||(e[29]=r=>S.value=!1)},"取消"),s("button",{class:"m3-button filled error",disabled:H.value,onClick:xe},d(H.value?"删除中...":"删除"),9,Qt)])])])):c("",!0)]}),_:1})])),(o(),Z(ee,{to:"body"},[L(B,{name:"dialog"},{default:O(()=>{var t;return[P.value?(o(),a("div",{key:0,class:"dialog-overlay",onClick:e[33]||(e[33]=D(r=>P.value=!1,["self"]))},[s("div",Ht,[s("div",At,[e[85]||(e[85]=s("h3",null,"确认重置",-1)),s("button",{class:"m3-icon-button",onClick:e[31]||(e[31]=r=>P.value=!1)},[...e[84]||(e[84]=[s("span",{class:"material-symbols-rounded"},"close",-1)])])]),s("div",Gt,[s("p",null,'确定要重置与用户 "'+d((t=n.value)==null?void 0:t.nickname)+'" 的关系吗？',1),e[86]||(e[86]=s("p",{class:"warning-text"},"这将清除 Bot 对该用户的记忆和关系进展，恢复到初始设定。",-1))]),s("div",Wt,[s("button",{class:"m3-button text",onClick:e[32]||(e[32]=r=>P.value=!1)},"取消"),s("button",{class:"m3-button filled error",disabled:A.value,onClick:Ue},d(A.value?"重置中...":"重置"),9,Xt)])])])):c("",!0)]}),_:1})]))]))}}),tl=je(Zt,[["__scopeId","data-v-666e62c5"]]);export{tl as default};
