import{a as z,c as n,o as a,n as F,e,g as N,t as m,_ as R,r as x,D,m as oe,N as Ce,l as M,P as X,s as U,M as Se,f as Q,w as G,q as Ne,F as P,h as q,T as te,J as Ie,L as B,aa as ee,O as ie,R as de,G as ue,v as Oe,i as Te,p as De,j as je,V as Ee}from"./index-I9RjNgOI.js";import{V as Le}from"./index-Dg_uf0FG.js";import{g as Fe,s as Be,r as Me,a as Je}from"./pluginConfig-B9mxjR0z.js";const Ue={class:"field-left"},Pe={class:"field-header"},ze={key:0,class:"material-symbols-rounded field-icon"},Re={class:"field-label"},Ae={key:1,class:"required-badge"},We={key:0,class:"field-description"},qe={class:"m3-switch"},Ge=["checked","disabled"],Ye={class:"switch-track"},He={class:"switch-thumb"},Xe={class:"thumb-icon material-symbols-rounded"},Qe=z({__name:"SwitchEditor",props:{field:{},modelValue:{}},emits:["update:modelValue"],setup(t,{emit:j}){const o=j;function I(u){const r=u.target;o("update:modelValue",r.checked)}return(u,r)=>(a(),n("div",{class:F(["switch-editor",{"is-checked":!!t.modelValue,"is-disabled":t.field.disabled}])},[e("div",Ue,[e("div",Pe,[t.field.icon?(a(),n("span",ze,m(t.field.icon),1)):N("",!0),e("span",Re,m(t.field.label||t.field.key),1),t.field.required?(a(),n("span",Ae,"必填")):N("",!0)]),t.field.description||t.field.hint?(a(),n("div",We,[r[0]||(r[0]=e("span",{class:"material-symbols-rounded desc-icon"},"info",-1)),e("span",null,m(t.field.hint||t.field.description),1)])):N("",!0)]),e("label",qe,[e("input",{type:"checkbox",checked:!!t.modelValue,disabled:t.field.disabled,onChange:I},null,40,Ge),e("span",Ye,[e("span",He,[e("span",Xe,m(t.modelValue?"check":""),1)])])])],2))}}),Ze=R(Qe,[["__scopeId","data-v-4e67e003"]]),Ke={class:"field-wrapper"},et=["value","placeholder","disabled","maxlength"],tt={key:0,class:"char-counter"},st=z({__name:"TextEditor",props:{field:{},modelValue:{}},emits:["update:modelValue"],setup(t,{emit:j}){const o=t,I=j,u=x(!1),r=D(()=>o.modelValue!==void 0&&o.modelValue!==null&&o.modelValue!=="");function y(g){const h=g.target;I("update:modelValue",h.value)}function V(){I("update:modelValue","")}return(g,h)=>(a(),n("div",{class:F(["m3-text-field-container",{"is-focused":u.value,"has-value":r.value}])},[e("div",Ke,[e("input",{type:"text",class:"m3-text-field",value:t.modelValue,placeholder:t.field.placeholder,disabled:t.field.disabled,maxlength:t.field.max_length,onInput:y,onFocus:h[0]||(h[0]=k=>u.value=!0),onBlur:h[1]||(h[1]=k=>u.value=!1)},null,40,et),h[3]||(h[3]=e("div",{class:"field-decoration"},[e("div",{class:"field-border"}),e("div",{class:"field-focus-indicator"})],-1)),r.value&&!t.field.disabled?(a(),n("button",{key:0,type:"button",class:"clear-button",onClick:V,tabindex:"-1"},[...h[2]||(h[2]=[e("span",{class:"material-symbols-rounded"},"close",-1)])])):N("",!0)]),t.field.max_length?(a(),n("div",tt,m(String(t.modelValue||"").length)+" / "+m(t.field.max_length),1)):N("",!0)],2))}}),lt=R(st,[["__scopeId","data-v-02c5fda9"]]),at=["disabled"],nt={class:"number-input-wrapper"},ot=["value","placeholder","disabled","min","max","step"],it={key:0,class:"range-indicator"},dt={key:0},ut={key:1},rt={key:2},ct=["disabled"],mt=z({__name:"NumberEditor",props:{field:{},modelValue:{}},emits:["update:modelValue"],setup(t,{emit:j}){const o=t,I=j,u=x(!1),r=D(()=>{const i=Number(o.modelValue);return isNaN(i)?0:i}),y=D(()=>o.field.min!==void 0&&r.value<=o.field.min),V=D(()=>o.field.max!==void 0&&r.value>=o.field.max);function g(i){const p=i.target,$=o.field.type==="int"?parseInt(p.value,10):parseFloat(p.value);I("update:modelValue",isNaN($)?0:$)}function h(){const i=o.field.step||1;let p=r.value-i;o.field.min!==void 0&&p<o.field.min&&(p=o.field.min),I("update:modelValue",o.field.type==="int"?Math.floor(p):p)}function k(){const i=o.field.step||1;let p=r.value+i;o.field.max!==void 0&&p>o.field.max&&(p=o.field.max),I("update:modelValue",o.field.type==="int"?Math.floor(p):p)}return(i,p)=>(a(),n("div",{class:F(["number-editor",{"is-focused":u.value}])},[e("button",{type:"button",class:"stepper-button decrease",disabled:t.field.disabled||y.value,onClick:h},[...p[2]||(p[2]=[e("span",{class:"material-symbols-rounded"},"remove",-1)])],8,at),e("div",nt,[e("input",{type:"number",class:"number-input",value:t.modelValue,placeholder:t.field.placeholder,disabled:t.field.disabled,min:t.field.min,max:t.field.max,step:t.field.step||1,onInput:g,onFocus:p[0]||(p[0]=$=>u.value=!0),onBlur:p[1]||(p[1]=$=>u.value=!1)},null,40,ot),t.field.min!==void 0||t.field.max!==void 0?(a(),n("div",it,[t.field.min!==void 0?(a(),n("span",dt,m(t.field.min),1)):N("",!0),t.field.min!==void 0&&t.field.max!==void 0?(a(),n("span",ut," ~ ")):N("",!0),t.field.max!==void 0?(a(),n("span",rt,m(t.field.max),1)):N("",!0)])):N("",!0)]),e("button",{type:"button",class:"stepper-button increase",disabled:t.field.disabled||V.value,onClick:k},[...p[3]||(p[3]=[e("span",{class:"material-symbols-rounded"},"add",-1)])],8,ct)],2))}}),vt=R(mt,[["__scopeId","data-v-4487a5b2"]]),ft=["onKeydown"],pt={class:"select-display"},bt={key:0,class:"selected-text"},yt={key:1,class:"placeholder-text"},gt={class:"dropdown-content"},ht=["onClick"],kt={class:"item-label"},$t={key:0,class:"material-symbols-rounded item-check"},_t={key:0,class:"dropdown-empty"},Vt=z({__name:"SelectEditor",props:{field:{},modelValue:{}},emits:["update:modelValue"],setup(t,{emit:j}){const o=t,I=j,u=x(!1),r=x(!1),y=x(null),V=x({top:"0px",left:"0px",width:"0px"}),g=D(()=>o.modelValue!==void 0&&o.modelValue!==null&&o.modelValue!==""),h=D(()=>o.field.choices?o.field.choices.map(v=>typeof v=="object"&&v!==null&&"value"in v?v:{value:v,label:String(v)}):[]),k=D(()=>{const v=h.value.find(_=>_.value===o.modelValue);return(v==null?void 0:v.label)||String(o.modelValue)});function i(){if(!y.value)return;const v=y.value.querySelector(".field-wrapper");if(!v)return;const _=v.getBoundingClientRect();V.value={top:`${_.bottom+4}px`,left:`${_.left}px`,width:`${_.width}px`}}function p(){o.field.disabled||(r.value=!r.value,u.value=r.value,r.value?Ie(()=>{i(),window.addEventListener("scroll",i,!0),window.addEventListener("resize",i)}):(window.removeEventListener("scroll",i,!0),window.removeEventListener("resize",i)))}function $(){r.value=!1,u.value=!1,window.removeEventListener("scroll",i,!0),window.removeEventListener("resize",i)}function A(v){setTimeout(()=>{$()},200)}function J(v){I("update:modelValue",v),$()}function C(v){const _=v.target,E=document.querySelector(".select-dropdown");y.value&&!y.value.contains(_)&&E&&!E.contains(_)&&$()}return oe(()=>{document.addEventListener("click",C)}),Ce(()=>{document.removeEventListener("click",C),window.removeEventListener("scroll",i,!0),window.removeEventListener("resize",i)}),(v,_)=>(a(),n("div",{class:F(["select-editor",{"is-focused":u.value,"has-value":g.value,"is-open":r.value}]),ref_key:"editorRef",ref:y},[e("div",{class:"field-wrapper",onClick:p,tabindex:"0",onFocus:_[0]||(_[0]=E=>u.value=!0),onBlur:A,onKeydown:[X(U(p,["prevent"]),["space"]),X(U(p,["prevent"]),["enter"]),X($,["esc"])]},[e("div",pt,[g.value?(a(),n("span",bt,m(k.value),1)):(a(),n("span",yt,m(t.field.placeholder||"请选择"),1))]),_[1]||(_[1]=e("span",{class:"select-arrow material-symbols-rounded"},"expand_more",-1)),_[2]||(_[2]=e("div",{class:"field-decoration"},[e("div",{class:"field-border"}),e("div",{class:"field-focus-indicator"})],-1))],40,ft),(a(),M(Se,{to:"body"},[Q(te,{name:"dropdown"},{default:G(()=>[r.value?(a(),n("div",{key:0,class:"select-dropdown",style:Ne(V.value)},[e("div",gt,[(a(!0),n(P,null,q(h.value,E=>(a(),n("div",{key:String(E.value),class:F(["dropdown-item",{"is-selected":E.value===t.modelValue}]),onClick:U(c=>J(E.value),["stop"])},[e("span",kt,m(E.label),1),E.value===t.modelValue?(a(),n("span",$t,"check")):N("",!0)],10,ht))),128)),h.value.length===0?(a(),n("div",_t," 无选项 ")):N("",!0)])],4)):N("",!0)]),_:1})]))],2))}}),wt=R(Vt,[["__scopeId","data-v-7a23e750"]]),xt={class:"field-wrapper"},Ct=["value","placeholder","disabled","rows","maxlength"],St={class:"textarea-footer"},Nt={key:0,class:"line-count"},It={key:1,class:"char-counter"},Ot={key:2,class:"char-counter"},Tt=z({__name:"TextareaEditor",props:{field:{},modelValue:{}},emits:["update:modelValue"],setup(t,{emit:j}){const o=t,I=j,u=x(!1),r=D(()=>String(o.modelValue||"").length),y=D(()=>String(o.modelValue||"").split(`
`).length);function V(g){const h=g.target;I("update:modelValue",h.value)}return(g,h)=>(a(),n("div",{class:F(["textarea-editor",{"is-focused":u.value}])},[e("div",xt,[e("textarea",{class:"textarea-input",value:t.modelValue,placeholder:t.field.placeholder||"输入内容...",disabled:t.field.disabled,rows:t.field.rows||4,maxlength:t.field.max_length,onInput:V,onFocus:h[0]||(h[0]=k=>u.value=!0),onBlur:h[1]||(h[1]=k=>u.value=!1)},null,40,Ct),h[2]||(h[2]=e("div",{class:"field-decoration"},[e("div",{class:"field-border"}),e("div",{class:"field-focus-indicator"})],-1))]),e("div",St,[y.value>1?(a(),n("span",Nt,[h[3]||(h[3]=e("span",{class:"material-symbols-rounded"},"format_list_numbered",-1)),B(" "+m(y.value)+" 行 ",1)])):N("",!0),t.field.max_length?(a(),n("span",It,m(r.value)+" / "+m(t.field.max_length),1)):(a(),n("span",Ot,m(r.value)+" 字符 ",1))])],2))}}),Dt=R(Tt,[["__scopeId","data-v-81b5bc00"]]),jt={class:"list-editor"},Et={class:"list-header"},Lt={class:"header-info"},Ft={class:"item-count"},Bt={key:0,class:"limit-badge"},Mt={key:0},Jt={key:1},Ut={key:2},Pt={class:"list-items"},zt=["onDragstart","onDragover","onDrop"],Rt={class:"item-index"},At={class:"item-input-wrapper"},Wt=["value","placeholder","onInput"],qt=["disabled","onClick"],Gt=["onDragstart","onDragover","onDrop"],Yt={class:"item-index"},Ht={class:"item-input-wrapper"},Xt=["value","placeholder","min","max","step","onInput"],Qt=["disabled","onClick"],Zt=["onDragstart","onDragover","onDrop"],Kt=["onClick"],es={class:"item-index"},ts={class:"object-item-title"},ss={class:"object-item-actions"},ls=["onClick"],as={class:"material-symbols-rounded"},ns=["disabled","onClick"],os={class:"object-item-content"},is={key:3,class:"empty-state"},ds=["disabled"],us=z({__name:"ListEditor",props:{field:{},modelValue:{}},emits:["update:modelValue"],setup(t,{emit:j}){const o=t,I=j;function u(c){var d;return{key:c.key,name:c.label||c.key,description:c.description||"",type:r(c.input_type||c.type||"string"),default:c.default,options:(d=c.choices)==null?void 0:d.map(S=>({value:String(S.value),label:S.label}))}}function r(c){return{text:"string",number:"number",switch:"boolean",list:"array",json:"object",textarea:"textarea",select:"select",string:"string",boolean:"boolean",array:"array",object:"object"}[c]||"string"}const y=D(()=>Array.isArray(o.modelValue)?o.modelValue:[]),V=x([0]),g=x(null);function h(c,d){const S=[...y.value];S[c]=d,I("update:modelValue",S)}function k(c,d,S){const b=[...y.value];b[c]={...b[c],[d]:S},I("update:modelValue",b)}function i(){const c=p(),d=[...y.value,c];I("update:modelValue",d),o.field.item_type==="object"&&V.value.push(d.length-1)}function p(){if(o.field.item_type==="number")return 0;if(o.field.item_type==="object"){const c={};if(o.field.item_fields)for(const d of o.field.item_fields)c[d.key]=d.default;return c}return""}function $(c){const d=[...y.value];d.splice(c,1),I("update:modelValue",d),V.value=V.value.filter(S=>S!==c).map(S=>S>c?S-1:S)}function A(c){const d=V.value.indexOf(c);d>-1?V.value.splice(d,1):V.value.push(c)}function J(c,d){if(o.field.item_fields){const S=o.field.item_fields.find(b=>b.input_type==="text"||b.input_type==="select");if(S&&c[S.key])return String(c[S.key])}return`项目 ${d+1}`}function C(c,d){g.value=c,d.dataTransfer&&(d.dataTransfer.effectAllowed="move",d.dataTransfer.setData("text/plain",String(c)))}function v(c){}function _(c){if(g.value===null||g.value===c)return;const d=[...y.value],[S]=d.splice(g.value,1);d.splice(c,0,S),I("update:modelValue",d),g.value=null}function E(){g.value=null}return(c,d)=>(a(),n("div",jt,[e("div",Et,[e("div",Lt,[d[1]||(d[1]=e("span",{class:"material-symbols-rounded header-icon"},"list",-1)),e("span",Ft,m(y.value.length),1)]),t.field.min_items||t.field.max_items?(a(),n("div",Bt,[t.field.min_items?(a(),n("span",Mt,"最小"+m(t.field.min_items),1)):N("",!0),t.field.min_items&&t.field.max_items?(a(),n("span",Jt," / ")):N("",!0),t.field.max_items?(a(),n("span",Ut,"最大"+m(t.field.max_items),1)):N("",!0)])):N("",!0)]),e("div",Pt,[!t.field.item_type||t.field.item_type==="string"?(a(),M(ee,{key:0,name:"list"},{default:G(()=>[(a(!0),n(P,null,q(y.value,(S,b)=>(a(),n("div",{key:"item-"+b,class:F(["list-item",{"is-dragging":g.value===b}]),draggable:"true",onDragstart:w=>C(b,w),onDragover:U(w=>void 0,["prevent"]),onDrop:w=>_(b),onDragend:E},[d[3]||(d[3]=e("div",{class:"item-handle"},[e("span",{class:"material-symbols-rounded"},"drag_indicator")],-1)),e("div",Rt,m(b+1),1),e("div",At,[e("input",{type:"text",class:"item-input",value:S,placeholder:t.field.placeholder||`输入第 ${b+1} 项`,onInput:w=>h(b,w.target.value)},null,40,Wt)]),e("button",{type:"button",class:"item-remove-button",disabled:t.field.min_items!==void 0&&y.value.length<=t.field.min_items,onClick:w=>$(b),title:"删除"},[...d[2]||(d[2]=[e("span",{class:"material-symbols-rounded"},"close",-1)])],8,qt)],42,zt))),128))]),_:1})):t.field.item_type==="number"?(a(),M(ee,{key:1,name:"list"},{default:G(()=>[(a(!0),n(P,null,q(y.value,(S,b)=>(a(),n("div",{key:"item-"+b,class:F(["list-item",{"is-dragging":g.value===b}]),draggable:"true",onDragstart:w=>C(b,w),onDragover:U(w=>void 0,["prevent"]),onDrop:w=>_(b),onDragend:E},[d[5]||(d[5]=e("div",{class:"item-handle"},[e("span",{class:"material-symbols-rounded"},"drag_indicator")],-1)),e("div",Yt,m(b+1),1),e("div",Ht,[e("input",{type:"number",class:"item-input",value:S,placeholder:t.field.placeholder||`输入第 ${b+1} 项`,min:t.field.min,max:t.field.max,step:t.field.step||1,onInput:w=>h(b,parseFloat(w.target.value)||0)},null,40,Xt)]),e("button",{type:"button",class:"item-remove-button",disabled:t.field.min_items!==void 0&&y.value.length<=t.field.min_items,onClick:w=>$(b),title:"删除"},[...d[4]||(d[4]=[e("span",{class:"material-symbols-rounded"},"close",-1)])],8,Qt)],42,Gt))),128))]),_:1})):t.field.item_type==="object"&&t.field.item_fields?(a(),M(ee,{key:2,name:"list"},{default:G(()=>[(a(!0),n(P,null,q(y.value,(S,b)=>(a(),n("div",{key:"item-"+b,class:F(["list-item object-item",{"is-expanded":V.value.includes(b),"is-dragging":g.value===b}]),draggable:"true",onDragstart:w=>C(b,w),onDragover:U(w=>void 0,["prevent"]),onDrop:w=>_(b),onDragend:E},[e("div",{class:"object-item-header",onClick:w=>A(b)},[e("div",{class:"item-handle",onClick:d[0]||(d[0]=U(()=>{},["stop"]))},[...d[6]||(d[6]=[e("span",{class:"material-symbols-rounded"},"drag_indicator",-1)])]),e("div",es,m(b+1),1),e("span",ts,m(J(S,b)),1),e("div",ss,[e("button",{type:"button",class:"expand-button",onClick:U(w=>A(b),["stop"])},[e("span",as,m(V.value.includes(b)?"expand_less":"expand_more"),1)],8,ls),e("button",{type:"button",class:"item-remove-button",disabled:t.field.min_items!==void 0&&y.value.length<=t.field.min_items,onClick:U(w=>$(b),["stop"]),title:"删除"},[...d[7]||(d[7]=[e("span",{class:"material-symbols-rounded"},"close",-1)])],8,ns)])],8,Kt),Q(te,{name:"expand"},{default:G(()=>[ie(e("div",os,[(a(!0),n(P,null,q(t.field.item_fields,w=>(a(),M(re,{key:w.key,field:u(w),"model-value":S[w.key],"onUpdate:modelValue":Y=>k(b,w.key,Y)},null,8,["field","model-value","onUpdate:modelValue"]))),128))],512),[[de,V.value.includes(b)]])]),_:2},1024)],42,Zt))),128))]),_:1})):N("",!0),y.value.length===0?(a(),n("div",is,[...d[8]||(d[8]=[e("span",{class:"material-symbols-rounded empty-icon"},"inbox",-1),e("span",{class:"empty-text"},"暂无项目，点击下方按钮添加",-1)])])):N("",!0)]),e("button",{type:"button",class:"add-button",disabled:t.field.max_items!==void 0&&y.value.length>=t.field.max_items,onClick:i},[...d[9]||(d[9]=[e("span",{class:"material-symbols-rounded"},"add",-1),e("span",null,"添加一项",-1)])],8,ds)]))}}),rs=R(us,[["__scopeId","data-v-6523f21d"]]),cs={class:"editor-header"},ms={class:"header-actions"},vs={class:"material-symbols-rounded"},fs={class:"editor-body"},ps={class:"line-numbers"},bs=["value","placeholder","disabled","onKeydown"],ys={class:"editor-footer"},gs={key:0,class:"error-message"},hs={key:1,class:"status-info"},ks={class:"size-info"},$s=z({__name:"JsonEditor",props:{field:{},modelValue:{}},emits:["update:modelValue"],setup(t,{emit:j}){const o=t,I=j,u=x(""),r=x(""),y=x(!1),V=x(!1);ue(()=>o.modelValue,C=>{typeof C=="object"&&C!==null?r.value=JSON.stringify(C,null,2):C==null&&(r.value="{}")},{immediate:!0});const g=D(()=>r.value),h=D(()=>Math.max(g.value.split(`
`).length,5));function k(C){const v=C.target;r.value=v.value,u.value="";try{const _=JSON.parse(v.value);I("update:modelValue",_),u.value=""}catch{u.value="无效的JSON 格式"}}function i(){y.value=!1,p()}function p(){try{const C=JSON.parse(r.value);r.value=JSON.stringify(C,null,2),u.value=""}catch{}}function $(){try{const C=JSON.parse(r.value);r.value=JSON.stringify(C),u.value=""}catch{}}function A(){navigator.clipboard.writeText(r.value),V.value=!0,setTimeout(()=>{V.value=!1},2e3)}function J(C){const v=C.target,_=v.selectionStart,E=v.selectionEnd,c=v.value;v.value=c.substring(0,_)+"  "+c.substring(E),v.selectionStart=v.selectionEnd=_+2,r.value=v.value}return(C,v)=>(a(),n("div",{class:F(["json-editor",{"is-focused":y.value,"has-error":!!u.value}])},[e("div",cs,[v[3]||(v[3]=e("div",{class:"header-left"},[e("span",{class:"material-symbols-rounded header-icon"},"data_object"),e("span",{class:"header-label"},"JSON 编辑器")],-1)),e("div",ms,[e("button",{type:"button",class:"action-button",onClick:p,title:"格式化"},[...v[1]||(v[1]=[e("span",{class:"material-symbols-rounded"},"format_align_left",-1)])]),e("button",{type:"button",class:"action-button",onClick:$,title:"压缩"},[...v[2]||(v[2]=[e("span",{class:"material-symbols-rounded"},"compress",-1)])]),e("button",{type:"button",class:"action-button",onClick:A,title:"复制"},[e("span",vs,m(V.value?"check":"content_copy"),1)])])]),e("div",fs,[e("div",ps,[(a(!0),n(P,null,q(h.value,_=>(a(),n("div",{key:_,class:"line-number"},m(_),1))),128))]),e("textarea",{class:"json-textarea",value:g.value,placeholder:t.field.placeholder||`{
  
}`,disabled:t.field.disabled,spellcheck:"false",onInput:k,onFocus:v[0]||(v[0]=_=>y.value=!0),onBlur:i,onKeydown:X(U(J,["prevent"]),["tab"])},null,40,bs)]),e("div",ys,[u.value?(a(),n("div",gs,[v[4]||(v[4]=e("span",{class:"material-symbols-rounded"},"error",-1)),B(" "+m(u.value),1)])):(a(),n("div",hs,[...v[5]||(v[5]=[e("span",{class:"material-symbols-rounded"},"check_circle",-1),B(" JSON 格式正确 ",-1)])])),e("span",ks,m(g.value.length)+" 字符",1)])],2))}}),_s=R($s,[["__scopeId","data-v-9aa18908"]]),Vs={class:"field-header"},ws={class:"field-label"},xs={class:"field-type-badge"},Cs={key:0,class:"field-description"},Ss={class:"field-input-container"},Ns={key:1,class:"field-error"},Is=z({__name:"SchemaFieldEditor",props:{field:{},modelValue:{}},emits:["update:modelValue"],setup(t,{emit:j}){const o=t,I=j,u=x(""),r=D(()=>{var k;return{key:o.field.key,label:o.field.name||o.field.key,description:o.field.description,input_type:y(o.field.type),choices:((k=o.field.options)==null?void 0:k.map(i=>({value:i.value,label:i.label})))??[],default:o.field.default,placeholder:"",hint:"",disabled:!1,required:!1,min:void 0,max:void 0,step:1,min_items:void 0,max_items:void 0,item_type:"string"}});function y(k){return{string:"text",number:"number",boolean:"switch",array:"list",object:"json",textarea:"textarea",select:"select"}[k]||"text"}function V(k){return{string:"文本",number:"数字",boolean:"开关",select:"选择",textarea:"多行文本",array:"列表",object:"对象"}[k]||k}function g(k){I("update:modelValue",k),h()}function h(k){u.value=""}return(k,i)=>(a(),n("div",{class:F(["schema-field-editor",{"has-error":u.value,"inline-field":t.field.type==="boolean"}])},[t.field.type==="boolean"?(a(),M(Ze,{key:0,field:r.value,"model-value":t.modelValue,"onUpdate:modelValue":g},null,8,["field","model-value"])):(a(),n(P,{key:1},[e("div",Vs,[e("span",ws,m(t.field.name||t.field.key),1),e("span",xs,m(V(t.field.type)),1)]),t.field.description?(a(),n("div",Cs,[i[0]||(i[0]=e("span",{class:"material-symbols-rounded desc-icon"},"info",-1)),e("span",null,m(t.field.description),1)])):N("",!0),e("div",Ss,[t.field.type==="select"?(a(),M(wt,{key:0,field:r.value,"model-value":t.modelValue,"onUpdate:modelValue":g},null,8,["field","model-value"])):t.field.type==="array"?(a(),M(rs,{key:1,field:r.value,"model-value":t.modelValue,"onUpdate:modelValue":g},null,8,["field","model-value"])):t.field.type==="number"?(a(),M(vt,{key:2,field:r.value,"model-value":t.modelValue,"onUpdate:modelValue":g},null,8,["field","model-value"])):t.field.type==="textarea"?(a(),M(Dt,{key:3,field:r.value,"model-value":t.modelValue,"onUpdate:modelValue":g},null,8,["field","model-value"])):t.field.type==="object"?(a(),M(_s,{key:4,field:r.value,"model-value":t.modelValue,"onUpdate:modelValue":g},null,8,["field","model-value"])):(a(),M(lt,{key:5,field:r.value,"model-value":t.modelValue,"onUpdate:modelValue":g},null,8,["field","model-value"]))]),u.value?(a(),n("div",Ns,[i[1]||(i[1]=e("span",{class:"material-symbols-rounded"},"error",-1)),B(" "+m(u.value),1)])):N("",!0)],64))],2))}}),re=R(Is,[["__scopeId","data-v-70e0bb5e"]]),Os={class:"header-left"},Ts={class:"section-icon material-symbols-rounded"},Ds={class:"header-text"},js={class:"section-title"},Es={key:0,class:"section-description"},Ls=["aria-label"],Fs={class:"material-symbols-rounded"},Bs={class:"section-content"},Ms={key:0,class:"empty-section"},Js=z({__name:"ConfigSection",props:{section:{},values:{}},emits:["update"],setup(t,{emit:j}){const o=t,I=j,u=x(!1),r=D(()=>{const k={database:"database",api:"cloud",personality:"psychology",permission:"lock",feature:"toggle_on",bot:"smart_toy",system:"settings",ui:"palette"},i=o.section.key.toLowerCase();for(const[p,$]of Object.entries(k))if(i.includes(p))return $;return"folder"});function y(k){var $;const i=k.indexOf("."),p=i===-1?k:k.slice(i+1);return($=o.values)==null?void 0:$[p]}function V(k,i){const p=k.indexOf("."),$=p===-1?k:k.slice(p+1);I("update",$,i)}function g(k){return k.replace(/_/g," ").replace(/\b\w/g,i=>i.toUpperCase())}function h(){u.value=!u.value}return(k,i)=>(a(),n("div",{class:F(["config-section",{collapsed:u.value}])},[e("div",{class:"section-header",onClick:h},[e("div",Os,[e("span",Ts,m(r.value),1),e("div",Ds,[e("h3",js,m(t.section.name||g(t.section.key)),1),t.section.description?(a(),n("p",Es,m(t.section.description),1)):N("",!0)])]),e("button",{class:"collapse-toggle","aria-label":u.value?"展开":"折叠"},[e("span",Fs,m(u.value?"expand_more":"expand_less"),1)],8,Ls)]),ie(e("div",Bs,[(a(!0),n(P,null,q(t.section.fields,p=>(a(),M(re,{key:p.key,field:p,"model-value":y(p.key),"onUpdate:modelValue":$=>V(p.key,$)},null,8,["field","model-value","onUpdate:modelValue"]))),128)),t.section.fields.length===0?(a(),n("div",Ms,[...i[0]||(i[0]=[e("span",{class:"material-symbols-rounded"},"inbox",-1),e("p",null,"该分组没有可显示的配置项",-1)])])):N("",!0)],512),[[de,!u.value]])],2))}}),Us=R(Js,[["__scopeId","data-v-e4a94ee7"]]),Ps={class:"plugin-config-view"},zs={class:"config-header"},Rs={class:"header-left"},As={class:"header-info"},Ws={class:"config-path"},qs={class:"header-actions"},Gs={class:"m3-segmented-button"},Ys=["disabled"],Hs=["disabled"],Xs=["disabled"],Qs=["disabled"],Zs={key:0,class:"loading-state"},Ks={key:1,class:"error-state"},el={key:0,class:"config-nav-bar"},tl=["onClick"],sl={class:"material-symbols-rounded"},ll={class:"field-badge"},al={key:0,class:"schema-badge",title:"Schema 增强"},nl={class:"config-content"},ol={key:1,class:"empty-state"},il={key:3,class:"empty-state"},dl={key:1,class:"source-editor"},ul={class:"source-toolbar"},rl={class:"toolbar-left"},cl={class:"file-path"},ml={class:"toolbar-actions"},vl=["disabled"],fl=["disabled"],pl={class:"monaco-container"},bl={class:"m3-dialog"},yl={class:"dialog-content"},gl={key:0,class:"loading-state"},hl={key:1,class:"backup-list"},kl={class:"backup-info"},$l={class:"backup-name"},_l={class:"backup-meta"},Vl={class:"backup-actions"},wl=["onClick"],xl={key:2,class:"empty-state"},Cl={class:"material-symbols-rounded"},Sl=z({__name:"PluginConfigView",setup(t){const j=Te(),o=je(),I=Oe(),u=D(()=>{const l=decodeURIComponent(j.params.path),s=l.split("/");return{pluginName:s[0]??"",configName:s[1]??"config",decodedPath:l}}),r=D(()=>u.value.decodedPath),y=x("visual"),V=x(!1),g=x(!1),h=x(""),k=x(0),i=x({}),p=x({}),$=x(""),A=x(""),J=x([]),C=x(!1),v=x(!1),_=x([]),E=x(null),c=x({show:!1,message:"",type:"success"}),d=D(()=>I.isDark),S={minimap:{enabled:!1},fontSize:14,lineHeight:24,fontFamily:"'JetBrains Mono', 'Fira Code', Consolas, monospace",scrollBeyondLastLine:!1,automaticLayout:!0,padding:{top:16,bottom:16},wordWrap:"on",tabSize:2},b=D(()=>J.value.length>0?J.value.map(l=>({key:l.key,display_name:l.name||ne(l.key),description:l.description,icon:ae(l.key),hasSchema:!0,schemaFields:l.fields})):Object.keys(i.value).map(l=>({key:l,display_name:ne(l),description:"",icon:ae(l),hasSchema:!1,schemaFields:[]}))),w=D(()=>J.value[k.value]??null),Y=D(()=>y.value==="source"?$.value!==A.value:JSON.stringify(i.value)!==JSON.stringify(p.value));oe(()=>{H()});function ce(){Y.value?confirm("有未保存的修改，确定要离开吗？")&&o.back():o.back()}function me(l){E.value&&Math.abs(l.deltaY)>Math.abs(l.deltaX)&&(l.preventDefault(),E.value.scrollLeft+=l.deltaY*.3)}function se(l){Y.value&&y.value!==l&&!confirm("切换模式将丢失未保存的修改，是否继续？")||(y.value=l,l==="visual"&&H())}function ve(l){const s={};let f="__root__";s[f]={};for(const T of l.split(`
`)){const O=T.trim();if(!O||O.startsWith("#"))continue;const L=O.match(/^\[([^\]]+)\]$/);if(L&&L[1]){f=L[1].trim(),s[f]||(s[f]={});continue}const K=O.indexOf("=");if(K===-1)continue;const we=O.slice(0,K).trim(),xe=O.slice(K+1).trim();s[f][we]=fe(xe)}return s.__root__&&Object.keys(s.__root__).length===0&&delete s.__root__,s}function fe(l){if(l==="true")return!0;if(l==="false")return!1;if(/^-?\d+$/.test(l))return parseInt(l,10);if(/^-?\d+\.\d+$/.test(l))return parseFloat(l);if(l.startsWith('"')&&l.endsWith('"'))return l.slice(1,-1).replace(/\\"/g,'"');if(l.startsWith("'")&&l.endsWith("'"))return l.slice(1,-1);if(l.startsWith("[")&&l.endsWith("]"))try{return JSON.parse(l.replace(/'/g,'"'))}catch{return l}return l}async function H(){var l,s;V.value=!0,h.value="";try{const{pluginName:f,configName:T}=u.value,O=await Fe(f,T);if(!((l=O.data)!=null&&l.success)){h.value=((s=O.data)==null?void 0:s.error)||O.error||"加载配置失败";return}$.value=O.data.content??"",A.value=$.value;const L=ve($.value);i.value=JSON.parse(JSON.stringify(L)),p.value=JSON.parse(JSON.stringify(L)),J.value=O.data.config_schema??[]}catch(f){h.value=f.message||"网络请求失败",console.error("加载配置失败:",f)}finally{V.value=!1}}function pe(l,s,f){i.value[l]||(i.value[l]={}),i.value[l][s]=f}async function be(){var l,s;if(!g.value){g.value=!0;try{const{pluginName:f,configName:T}=u.value;let O;y.value==="source"?O=$.value:O=ye(i.value);const L=await Be(f,T,O);(l=L.data)!=null&&l.success?(W("配置已保存","success"),await H()):W(((s=L.data)==null?void 0:s.error)||L.error||"保存失败","error")}catch(f){W(f.message||"保存请求失败","error")}finally{g.value=!1}}}function ye(l){const s=[];for(const[f,T]of Object.entries(l)){if(f==="__root__"){for(const[O,L]of Object.entries(T))s.push(`${O} = ${le(L)}`);s.length>0&&s.push("");continue}s.push(`[${f}]`);for(const[O,L]of Object.entries(T))s.push(`${O} = ${le(L)}`);s.push("")}return s.join(`
`)}function le(l){return typeof l=="boolean"?l?"true":"false":typeof l=="number"?String(l):Array.isArray(l)?JSON.stringify(l):l==null?'""':`"${String(l).replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function ge(){W("TOML 格式化功能开发中","error")}async function he(){try{(await Ee(()=>import("./index--izFXTDO.js").then(s=>s.i),[])).parse($.value),W("TOML 格式验证通过","success")}catch(l){W(`TOML 格式错误: ${l.message}`,"error")}}function ke(l){console.log("Monaco 编辑器已加载")}ue(C,l=>{l&&$e()});async function $e(){var l;v.value=!0;try{const{pluginName:s,configName:f}=u.value,T=await Je(s,f);(l=T.data)!=null&&l.success&&Array.isArray(T.data.backups)?_.value=T.data.backups:_.value=[]}catch(s){console.error("获取备份列表失败:",s),_.value=[]}finally{v.value=!1}}async function _e(l){var s,f;if(confirm(`确定要还原到备份版本 "${l.name}" 吗？当前配置将被覆盖。`))try{const{pluginName:T,configName:O}=u.value,L=await Me(T,O,l.name);(s=L.data)!=null&&s.success?(W("配置已从备份还原","success"),Z(),await H()):W(((f=L.data)==null?void 0:f.error)||L.error||"还原失败","error")}catch(T){W(T.message||"还原请求失败","error")}}function Z(){C.value=!1}function Ve(l){return l<1024?l+" B":l<1024*1024?(l/1024).toFixed(1)+" KB":(l/(1024*1024)).toFixed(1)+" MB"}function W(l,s="success"){c.value={show:!0,message:l,type:s},setTimeout(()=>{c.value.show=!1},3e3)}function ae(l){const s={database:"database",api_providers:"cloud",personality:"psychology",permission:"lock",feature:"toggle_on",bot:"smart_toy",system:"settings",ui:"palette"};for(const[f,T]of Object.entries(s))if(l.toLowerCase().includes(f))return T;return"folder"}function ne(l){return l.replace(/_/g," ").replace(/\b\w/g,s=>s.toUpperCase())}return(l,s)=>(a(),n("div",Ps,[e("header",zs,[e("div",Rs,[e("button",{class:"m3-icon-button",onClick:ce,title:"返回"},[...s[5]||(s[5]=[e("span",{class:"material-symbols-rounded"},"arrow_back",-1)])]),s[7]||(s[7]=e("div",{class:"header-icon-container"},[e("span",{class:"material-symbols-rounded header-icon"},"settings")],-1)),e("div",As,[e("h1",null,m(u.value.configName)+" 配置",1),e("p",Ws,[s[6]||(s[6]=e("span",{class:"material-symbols-rounded path-icon"},"folder",-1)),B(" "+m(r.value),1)])])]),e("div",qs,[e("div",Gs,[e("button",{class:F(["segment",{active:y.value==="visual"}]),onClick:s[0]||(s[0]=f=>se("visual")),disabled:V.value},[...s[8]||(s[8]=[e("span",{class:"material-symbols-rounded"},"grid_view",-1),B(" 可视化 ",-1)])],10,Ys),e("button",{class:F(["segment",{active:y.value==="source"}]),onClick:s[1]||(s[1]=f=>se("source")),disabled:V.value},[...s[9]||(s[9]=[e("span",{class:"material-symbols-rounded"},"code",-1),B(" 源码 ",-1)])],10,Hs)]),e("button",{class:"m3-icon-button",onClick:s[2]||(s[2]=f=>C.value=!0),title:"备份历史",disabled:V.value},[...s[10]||(s[10]=[e("span",{class:"material-symbols-rounded"},"history",-1)])],8,Xs),e("button",{class:"m3-button filled",onClick:be,disabled:g.value||!Y.value||V.value},[e("span",{class:F(["material-symbols-rounded",{spinning:g.value}])},m(g.value?"progress_activity":"save"),3),B(" "+m(g.value?"保存中...":"保存配置"),1)],8,Qs)])]),y.value==="visual"?(a(),n("div",{key:0,class:F(["visual-editor",{"schema-mode":J.value.length>0}])},[V.value?(a(),n("div",Zs,[...s[11]||(s[11]=[e("span",{class:"material-symbols-rounded spinning"},"progress_activity",-1),e("p",null,"加载配置中...",-1)])])):h.value?(a(),n("div",Ks,[s[13]||(s[13]=e("span",{class:"material-symbols-rounded error-icon"},"error",-1)),e("p",null,m(h.value),1),e("button",{class:"m3-button text",onClick:H},[...s[12]||(s[12]=[e("span",{class:"material-symbols-rounded"},"refresh",-1),B(" 重试 ",-1)])])])):b.value.length>0?(a(),n(P,{key:2},[b.value.length>1?(a(),n("div",el,[e("div",{class:"nav-tabs",ref_key:"navTabsRef",ref:E,onWheel:me},[(a(!0),n(P,null,q(b.value,(f,T)=>{var O;return a(),n("button",{key:f.key,class:F(["nav-tab",{active:k.value===T,"has-schema":f.hasSchema}]),onClick:L=>k.value=T},[e("span",sl,m(f.icon),1),B(" "+m(f.display_name)+" ",1),e("span",ll,m(((O=f.schemaFields)==null?void 0:O.length)??0),1),f.hasSchema?(a(),n("span",al,[...s[14]||(s[14]=[e("span",{class:"material-symbols-rounded"},"auto_awesome",-1)])])):N("",!0)],10,tl)}),128))],544)])):N("",!0),e("div",nl,[w.value?(a(),M(Us,{key:0,section:w.value,values:i.value[w.value.key]??{},onUpdate:s[3]||(s[3]=(f,T)=>pe(w.value.key,f,T))},null,8,["section","values"])):(a(),n("div",ol,[...s[15]||(s[15]=[e("span",{class:"material-symbols-rounded empty-icon"},"description",-1),e("p",null,"未选择配置节",-1)])]))])],64)):(a(),n("div",il,[...s[16]||(s[16]=[e("span",{class:"material-symbols-rounded empty-icon"},"description",-1),e("p",null,"该配置文件为空",-1)])]))],2)):(a(),n("div",dl,[e("div",ul,[e("div",rl,[s[17]||(s[17]=e("span",{class:"material-symbols-rounded"},"description",-1)),e("span",cl,m(r.value),1)]),e("div",ml,[e("button",{class:"m3-button text small",onClick:ge,disabled:!$.value},[...s[18]||(s[18]=[e("span",{class:"material-symbols-rounded"},"format_align_left",-1),B(" 格式化 ",-1)])],8,vl),e("button",{class:"m3-button text small",onClick:he,disabled:!$.value},[...s[19]||(s[19]=[e("span",{class:"material-symbols-rounded"},"check_circle",-1),B(" 验证 ",-1)])],8,fl)])]),e("div",pl,[Q(De(Le),{value:$.value,"onUpdate:value":s[4]||(s[4]=f=>$.value=f),language:"ini",theme:d.value?"vs-dark":"vs",options:S,onMount:ke},null,8,["value","theme"])])])),C.value?(a(),n("div",{key:2,class:"m3-dialog-overlay",onClick:U(Z,["self"])},[e("div",bl,[e("div",{class:"dialog-header"},[s[21]||(s[21]=e("div",{class:"dialog-title"},[e("span",{class:"material-symbols-rounded"},"history"),e("h3",null,"备份管理")],-1)),e("button",{class:"m3-icon-button",onClick:Z},[...s[20]||(s[20]=[e("span",{class:"material-symbols-rounded"},"close",-1)])])]),e("div",yl,[v.value?(a(),n("div",gl,[...s[22]||(s[22]=[e("span",{class:"material-symbols-rounded spinning"},"progress_activity",-1),e("p",null,"加载备份列表...",-1)])])):_.value.length?(a(),n("div",hl,[(a(!0),n(P,null,q(_.value,f=>(a(),n("div",{class:"backup-item",key:f.path},[s[27]||(s[27]=e("div",{class:"backup-icon"},[e("span",{class:"material-symbols-rounded"},"save")],-1)),e("div",kl,[e("span",$l,m(f.name),1),e("span",_l,[s[23]||(s[23]=e("span",{class:"material-symbols-rounded meta-icon"},"schedule",-1)),B(" "+m(f.created_at)+" ",1),s[24]||(s[24]=e("span",{class:"separator"},"·",-1)),s[25]||(s[25]=e("span",{class:"material-symbols-rounded meta-icon"},"storage",-1)),B(" "+m(Ve(f.size)),1)])]),e("div",Vl,[e("button",{class:"m3-button text small",onClick:T=>_e(f)},[...s[26]||(s[26]=[e("span",{class:"material-symbols-rounded"},"restore",-1),B(" 还原 ",-1)])],8,wl)])]))),128))])):(a(),n("div",xl,[...s[28]||(s[28]=[e("span",{class:"material-symbols-rounded empty-icon"},"history_toggle_off",-1),e("p",null,"暂无备份记录",-1),e("p",{class:"empty-hint"},"保存配置时将自动创建备份",-1)])]))])])])):N("",!0),Q(te,{name:"toast"},{default:G(()=>[c.value.show?(a(),n("div",{key:0,class:F(["m3-snackbar",c.value.type])},[e("span",Cl,m(c.value.type==="success"?"check_circle":"error"),1),B(" "+m(c.value.message),1)],2)):N("",!0)]),_:1})]))}}),Tl=R(Sl,[["__scopeId","data-v-4cedbf1e"]]);export{Tl as default};
