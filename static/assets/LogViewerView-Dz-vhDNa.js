import{S as $,a as N,r as i,D as E,m as D,c as l,a6 as I,e as s,n as L,F as x,h as T,g,t as r,O as A,Q as B,P as R,J as U,o,q,_ as H}from"./index-CLTUvmfq.js";function K(){return $.get("log_viewer/files")}function O(f){const c=new URLSearchParams;return Object.entries(f).forEach(([p,d])=>{d!=null&&d!==""&&c.append(p,d.toString())}),$.get(`log_viewer/search?${c.toString()}`)}function Q(f){return $.get(`log_viewer/stats?filename=${encodeURIComponent(f)}`)}const j={class:"log-viewer-view"},J={class:"content-wrapper"},W={class:"main-grid"},G={class:"file-panel m3-card"},X={class:"panel-header"},Y=["disabled"],Z={key:0,class:"file-list"},ee=["onClick"],se={class:"file-info"},ae={class:"file-name"},te={class:"file-meta"},le={key:1,class:"loading-state"},oe={key:2,class:"empty-state"},ne={class:"log-panel m3-card"},ie={key:0,class:"toolbar"},re={class:"toolbar-left"},de={class:"material-symbols-rounded"},ce={class:"file-title"},ue={key:0,class:"log-count"},ve={class:"toolbar-right"},me={class:"search-box"},pe={key:0,class:"welcome-screen"},ge={key:1,class:"loading-state"},fe={key:2,class:"log-list"},_e={class:"timestamp"},he=["innerHTML"],ye={key:0,class:"empty-result"},be={key:1,class:"pagination"},ke=["disabled"],we={class:"page-info"},Ce=["disabled"],Le=N({__name:"LogViewerView",setup(f){const c=i(!1),p=i(!1),d=i([]),n=i(""),m=i([]),k=i(null),w=i(null),u=i(""),v=i(1),C=i(100),_=i(0),h=E(()=>Math.ceil(_.value/C.value)),F=async()=>{var t;c.value=!0;try{const e=await K();e&&e.success&&Array.isArray((t=e.data)==null?void 0:t.files)?d.value=e.data.files.sort((a,b)=>b.mtime-a.mtime):(d.value=[],console.warn("Invalid response from getLogFiles API",e))}catch(e){console.error("Failed to load file list",e),d.value=[]}finally{c.value=!1}},V=async t=>{n.value!==t&&(n.value=t,v.value=1,u.value="",m.value=[],await z(),await y())},z=async()=>{if(n.value)try{const t=await Q(n.value);k.value=t}catch(t){console.error("Failed to load stats",t),k.value=null}},y=async()=>{var t,e;if(n.value){p.value=!0;try{const a=await O({filename:n.value,query:u.value,limit:C.value,offset:(v.value-1)*C.value});a&&a.success&&(m.value=((t=a.data)==null?void 0:t.entries)||[],_.value=((e=a.data)==null?void 0:e.total)||0,U(()=>{w.value&&(w.value.scrollTop=0)}))}catch(a){console.error("Search failed",a),m.value=[],_.value=0}finally{p.value=!1}}},S=t=>{t<1||t>h.value||(v.value=t,y())},P=t=>{if(!t)return"--:--:--";try{const e=new Date(t);if(isNaN(e.getTime())){const a=t.match(/T?(\d{2}):(\d{2}):(\d{2})/);return a?`${a[1]}:${a[2]}:${a[3]}`:"--:--:--"}return e.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}catch{return"--:--:--"}},M=t=>{if(!t)return"";if(!u.value)return t;const e=u.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),a=new RegExp(`(${e})`,"gi");return t.replace(a,'<mark class="highlight">$1</mark>')};return D(()=>{F()}),(t,e)=>(o(),l("div",j,[e[15]||(e[15]=I('<div class="page-header" data-v-dbf76a1c><div class="header-content" data-v-dbf76a1c><div class="title-group" data-v-dbf76a1c><span class="material-symbols-rounded title-icon" data-v-dbf76a1c>history</span><h1 class="page-title" data-v-dbf76a1c>历史日志</h1></div><p class="page-description" data-v-dbf76a1c>查看和搜索历史日志文件</p></div></div>',1)),s("div",J,[s("div",W,[s("div",G,[s("div",X,[e[4]||(e[4]=s("div",{class:"header-title"},[s("span",{class:"material-symbols-rounded"},"folder_open"),s("h3",null,"日志文件")],-1)),s("button",{class:"m3-icon-button",onClick:F,title:"刷新列表",disabled:c.value},[s("span",{class:L(["material-symbols-rounded",{spinning:c.value}])},"refresh",2)],8,Y)]),!c.value&&d.value.length>0?(o(),l("div",Z,[(o(!0),l(x,null,T(d.value,a=>(o(),l("div",{key:a.name,class:L(["file-item",{active:n.value===a.name}]),onClick:b=>V(a.name)},[e[5]||(e[5]=s("span",{class:"material-symbols-rounded file-icon"},"description",-1)),s("div",se,[s("div",ae,r(a.name),1),s("div",te,r(a.size_human)+" · "+r(a.mtime_human),1)])],10,ee))),128))])):c.value?(o(),l("div",le,[...e[6]||(e[6]=[s("span",{class:"material-symbols-rounded spinning"},"refresh",-1),s("p",null,"正在加载文件列表...",-1)])])):(o(),l("div",oe,[...e[7]||(e[7]=[s("span",{class:"material-symbols-rounded"},"folder_off",-1),s("p",null,"暂无日志文件",-1)])]))]),s("div",ne,[n.value?(o(),l("div",ie,[s("div",re,[s("span",de,r(n.value.endsWith(".gz")?"folder_zip":"description"),1),s("span",ce,r(n.value),1),k.value?(o(),l("span",ue,r(_.value)+" 条记录",1)):g("",!0)]),s("div",ve,[s("div",me,[e[9]||(e[9]=s("span",{class:"material-symbols-rounded search-icon"},"search",-1)),A(s("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>u.value=a),onKeyup:R(y,["enter"]),placeholder:"搜索日志内容...",class:"search-input"},null,544),[[B,u.value]]),u.value?(o(),l("button",{key:0,class:"m3-icon-button small",onClick:e[1]||(e[1]=a=>{u.value="",y()})},[...e[8]||(e[8]=[s("span",{class:"material-symbols-rounded"},"close",-1)])])):g("",!0)])])])):g("",!0),s("div",{class:"log-content",ref_key:"logContainer",ref:w},[n.value?p.value&&m.value.length===0?(o(),l("div",ge,[...e[11]||(e[11]=[s("span",{class:"material-symbols-rounded spinning"},"refresh",-1),s("p",null,"正在加载日志...",-1)])])):(o(),l("div",fe,[(o(!0),l(x,null,T(m.value,(a,b)=>(o(),l("div",{key:b,class:"log-entry"},[s("span",_e,r(P(a.timestamp)),1),s("span",{class:L(["level-badge",`level-${a.level.toLowerCase()}`])},r(a.level),3),s("span",{class:"logger",style:q({color:a.logger_color||"var(--md-sys-color-tertiary)"})},r(a.logger_name||"root"),5),s("span",{class:"message",innerHTML:M(a.event)},null,8,he)]))),128)),m.value.length===0?(o(),l("div",ye,[...e[12]||(e[12]=[s("span",{class:"material-symbols-rounded"},"search_off",-1),s("p",null,"没有找到匹配的日志记录",-1)])])):g("",!0),h.value>1?(o(),l("div",be,[s("button",{class:"m3-button text",disabled:v.value<=1,onClick:e[2]||(e[2]=a=>S(v.value-1))},[...e[13]||(e[13]=[s("span",{class:"material-symbols-rounded"},"chevron_left",-1),s("span",null,"上一页",-1)])],8,ke),s("span",we,"第 "+r(v.value)+" / "+r(h.value)+" 页",1),s("button",{class:"m3-button text",disabled:v.value>=h.value,onClick:e[3]||(e[3]=a=>S(v.value+1))},[...e[14]||(e[14]=[s("span",null,"下一页",-1),s("span",{class:"material-symbols-rounded"},"chevron_right",-1)])],8,Ce)])):g("",!0)])):(o(),l("div",pe,[...e[10]||(e[10]=[s("span",{class:"material-symbols-rounded welcome-icon"},"inbox",-1),s("h3",null,"请选择日志文件",-1),s("p",null,"从左侧列表中选择一个日志文件开始查看",-1)])]))],512)])])])]))}}),Fe=H(Le,[["__scopeId","data-v-dbf76a1c"]]);export{Fe as default};
